// Objekte mit I-Frame-URL passend zu Chart-ID
var id_object_res = {

    // Zweitstimmen Gemeinden Map
    "r675i": `<iframe title="Bundestagswahl 2021 - So haben die Sachsen gewählt" aria-label="Karte" id="datawrapper-chart-r675i" src="https://datawrapper.dwcdn.net/r675i" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="600"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`,
    // Erststimmen Gemeinden Map
    "pLIgz": `<iframe title="So hat Sachsen für die Direktkandidaten gestimmt " aria-label="Karte" id="datawrapper-chart-pLIgz" src="https://datawrapper.dwcdn.net/pLIgz/3/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="752"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 

    //Wahllokale
    //Dresden
    "Lx76L": `<iframe title="So haben Ihre Nachbarn in Dresden gewählt" aria-label="Karte" id="datawrapper-chart-Lx76L" src="https://datawrapper.dwcdn.net/Lx76L/2/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="627"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    //Leipzig
    "jgol0": `<iframe title="So haben Ihre Nachbarn in Leipzig gewählt" aria-label="Karte" id="datawrapper-chart-jgol0" src="https://datawrapper.dwcdn.net/jgol0/2/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="783"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    //Chemnitz
    "qKHTI": `<iframe title="So haben Ihre Nachbarn in Chemnitz gewählt" aria-label="Karte" id="datawrapper-chart-qKHTI" src="https://datawrapper.dwcdn.net/qKHTI/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="606"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    
    // Wahlkreis PRINT Erststimme
    
    // WK155
    "bwpEN": `<iframe title="So hat der Wahlkreis 155 (Meißen) gewählt - Erststimme" aria-label="Säulen" id="datawrapper-chart-bwpEN" src="https://datawrapper.dwcdn.net/bwpEN/3/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    // WK156 - Bautzen I 
    "V4cTH": `<iframe title="So hat der Wahlkreis 156 (Bautzen I) gewählt - Erststimme" aria-label="Säulen" id="datawrapper-chart-V4cTH" src="https://datawrapper.dwcdn.net/V4cTH/3/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    // WK 157
    "7SnKy": `<iframe title="So hat der Wahlkreis 157 (Görlitz) gewählt - Erststimme" aria-label="Säulen" id="datawrapper-chart-7SnKy" src="https://datawrapper.dwcdn.net/7SnKy/3/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    // WK 158
    "dwDUx": `<iframe title="So hat der Wahlkreis 158 (SSOE) gewählt - Erststimme" aria-label="Säulen" id="datawrapper-chart-dwDUx" src="https://datawrapper.dwcdn.net/dwDUx/4/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    // WK 161
    "hRaJz": `<iframe title="So hat der Wahlkreis 161 (Mittelsachsen) gewählt - Erststimme" aria-label="Säulen" id="datawrapper-chart-hRaJz" src="https://datawrapper.dwcdn.net/hRaJz/5/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`,


    // Wahlkreis Print Zweitstimme
    // wk155
    "uJaIJ": `<iframe title="So hat der Wahlkreis 155 (Meißen) gewählt - Zweitstimme" aria-label="Säulen" id="datawrapper-chart-uJaIJ" src="https://datawrapper.dwcdn.net/uJaIJ/7/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`,
    //wk156 
    "M1VEB": `<iframe title="So hat der Wahlkreis 156 (Bautzen I) gewählt - Zweitstimme" aria-label="Säulen" id="datawrapper-chart-M1VEB" src="https://datawrapper.dwcdn.net/M1VEB/9/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    //wk157
    "ynwmP": `<iframe title="So hat der Wahlkreis 157 (Görlitz) gewählt - Zweitstimme" aria-label="Säulen" id="datawrapper-chart-ynwmP" src="https://datawrapper.dwcdn.net/ynwmP/8/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    //wk158
    "Pk2Zx": `<iframe title="So hat der Wahlkreis 158 (SSOE) gewählt - Zweitstimme" aria-label="Säulen" id="datawrapper-chart-Pk2Zx" src="https://datawrapper.dwcdn.net/Pk2Zx/8/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`, 
    //wk161
    "h8f5r": `<iframe title="So hat der Wahlkreis 161 (Mittelsachsen) gewählt - Zweitstimme" aria-label="Säulen" id="datawrapper-chart-h8f5r" src="https://datawrapper.dwcdn.net/h8f5r/8/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="468"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();
    </script>`
    
}

var id_object_png = {

    // Map Gemeinden Zweistimme
    "r675i": `https://wahlkarte.app.dmwm.de/png/gemeinden/zweitstimmen_gemeinden_map.png`, 
    
    // Map Gemeinden Erststimme
    "pLIgz": `https://wahlkarte.app.dmwm.de/png/gemeinden/erststimmen_gemeinden_map.png`,

    //Wahlbezirke
    "Lx76L":  `https://wahlkarte.app.dmwm.de/png/wahllokale/wahllokale_dresden.png`,
    "jgol0": `https://wahlkarte.app.dmwm.de/png/wahllokale/wahllokale_leipzig.png`, 
    "qKHTI": `https://wahlkarte.app.dmwm.de/png/wahllokale/wahllokale_chemnitz.png`, 
    
    // Wahlkreise PRINT Erststimmen
    //K 155
    "bwpEN": "https://wahlkarte.app.dmwm.de/png/wahlkreise/155_erststimme.png",     
    // WK 156 
    "V4cTH": "https://wahlkarte.app.dmwm.de/png/wahlkreise/156_erststimme.png", 
    // WK 157
    "7SnKy": "https://wahlkarte.app.dmwm.de/png/wahlkreise/157_erststimme.png", 
    //WK 158
    "dwDUx": "https://wahlkarte.app.dmwm.de/png/wahlkreise/158_erststimme.png",
    //WK 161
    "hRaJz": "https://wahlkarte.app.dmwm.de/png/wahlkreise/161_erststimme.png",
 
    // Wahlkreise PRINT Zweitstimmen
    //wk 155
    "uJaIJ": "https://wahlkarte.app.dmwm.de/png/wahlkreise_zweitstimme/155_zweitstimme.png",
    //wk156
    "M1VEB": "https://wahlkarte.app.dmwm.de/png/wahlkreise_zweitstimme/156_zweitstimme.png",
    //wk157
    "ynwmP": "https://wahlkarte.app.dmwm.de/png/wahlkreise_zweitstimme/157_zweitstimme.png",
    //wk158
    "Pk2Zx": "https://wahlkarte.app.dmwm.de/png/wahlkreise_zweitstimme/158_zweitstimme.png",
    //wk161
    "h8f5r": "https://wahlkarte.app.dmwm.de/png/wahlkreise_zweitstimme/161_zweitstimme.png"

}

var translation_dw_id = {

    "r675i": "zweitstimmen_gemeinden_map.png",
    "pLIgz": "erststimmen_gemeinden_map.png",

    "Lx76L": "wahllokale_dresden.png", 
    "jgol0": "wahllokale_leipzig.png", 
    "qKHTI": "wahllokale_chemnitz.png", 

    "bwpEN": "wk155_erststimme.png", 
    "V4cTH": "wk156_erststimme.png",
    "7SnKy": "wk157_erststimme.png",
    "dwDUx": "wk158_erststimme.png",
    "hRaJz": "wk161_erststimme.png",

    "uJaIJ": "wk155_zweitstimme.png", 
    "M1VEB": "wk156_zweitstimme.png",
    "ynwmP": "wk157_zweitstimme.png",
    "Pk2Zx": "wk158_zweitstimme.png",
    "h8f5r": "wk161_zweitstimme.png",
   
}
  

// Funktion beefüllt die Textfelder über Button mit iframe-URL
const textfelder = document.getElementsByClassName("input-area"); 
for (const el of textfelder){
    console.log("loop gezündet"); 
    console.log(el.type)
    if (el.name==="resiframe"){
        el.value = id_object_res[el.placeholder]
    }else if (el.name==="png"){
        el.value = id_object_png[el.placeholder]
    }
    console.log(el)
}  


// Func für Iframe-Kopie in Clipboard

const copyStringToClipboard = (str)=> {
    // Temporäres Element erzeugen
    let el = document.createElement('textarea');
    // Den zu kopierenden String dem Element zuweisen
    el.value = str;
    // Element nicht editierbar setzen und aus dem Fenster schieben
    el.setAttribute('readonly', '');
    el.style = {position: 'absolute', left: '-9999px'};
    document.body.appendChild(el);
    // Text innerhalb des Elements auswählen
    el.select();
    // Ausgewählten Text in die Zwischenablage kopieren
    document.execCommand('copy');
    // Temporäres Element löschen
    document.body.removeChild(el);
 }
 



// Using fetch
async function downloadImage(imageSrc, id) {
    const image = await fetch(imageSrc)
    const imageBlog = await image.blob()
    const imageURL = URL.createObjectURL(imageBlog)
  
    const link = document.createElement('a')
    link.href = imageURL
    link.download = id
    document.body.appendChild(link)
    link.click()
    document.body.removeChild(link)
  }




// Funktion für Clipboard-Kopie der Iframe-URL
const copyButton = (data) =>{
    console.log("-----------------")
    console.log(data)
    console.log(data.info)
    const hideButton = ()=>{

    }
    let string; 
    //textnode ist das form-Element zum jeweiligen Button
    let textnode; 

    if (data.name ==="resiframe"){
        string = id_object_res[data.value]; 
        // Text in Clipboard kopieren
        copyStringToClipboard(string)
        
    }else if(data.name === "png"){
        
        string = id_object_png[data.value];
        id_wk = translation_dw_id[data.value];
        // url herunterladen
        downloadImage(string, id_wk)
       
    }else{
        console.log("Achtung - keine Chart-ID gefunden!!!"); 
       
    }
    

    //Steuerung des "Kopiert!"-Buttons
    // let button = data.parentNode.parentNode.lastChild.querySelector("button");
    let button = data.parentNode.parentNode.getElementsByClassName("ok-button")[0];
  
    button.classList.remove('ok-button')
    button.classList.add('show-button')    
        setTimeout(function(){
            button.classList.remove('show-button')
            button.classList.add('ok-button')
        }, 850)
}

  